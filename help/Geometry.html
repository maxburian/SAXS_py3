

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>The Geometry &mdash; SAXS py3.5 V3 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'./',
              VERSION:'py3.5 V3',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Polarization Correction" href="PolCorr.html" />
    <link rel="prev" title="Integration as Matrix-Vector Multiplication" href="MatrixMulti.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> SAXS
          

          
          </a>

          
            
            
              <div class="version">
                3.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="TheTools.html">The Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="Server.html">The Saxsdog Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="SAXSSchemaDoc.html">The Dedector Calibration File</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="TheTechnology.html">The Technology</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="MatrixMulti.html">Integration as Matrix-Vector Multiplication</a></li>
<li class="toctree-l2"><a class="reference internal" href="MatrixMulti.html#over-sampling">Over sampling</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">The Geometry</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tilt-angle-correction-test">Tilt Angle Correction Test</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="PolCorr.html">Polarization Correction</a></li>
<li class="toctree-l2"><a class="reference internal" href="Fit2d.html">Compare With Fit2d</a></li>
<li class="toctree-l2"><a class="reference internal" href="ConstantImage.html">Integrating a Constant Image With Masked Values</a></li>
<li class="toctree-l2"><a class="reference internal" href="Statistics.html">Statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="Slices.html">GISAXS Slices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="LeashDeveloperDoc.html">SAXSDOG Developer Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="SAXSapi.html">SAXS Module API</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">SAXS</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="TheTechnology.html">The Technology</a> &raquo;</li>
        
      <li>The Geometry</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/Geometry.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="the-geometry">
<span id="geometry"></span><h1>The Geometry<a class="headerlink" href="#the-geometry" title="Permalink to this headline">¶</a></h1>
<p>The plane of the sensor is not perfectly normal to the beam. So in order to calculate witch
pixel is on witch cone in the diffracted light, we need to express the geometry somehow.</p>
<p>Every pixel has the polar coordinates <span class="math notranslate nohighlight">\(r\)</span>, <span class="math notranslate nohighlight">\(\phi\)</span> with the projected diffraction center in the origin.
For each pixel (P) the triangle S,C,P (Sample, Center, Pixel, <span class="math notranslate nohighlight">\(\theta\)</span>, <span class="math notranslate nohighlight">\(\beta\)</span>, <span class="math notranslate nohighlight">\(\gamma\)</span>)
can be fully expressed with the law of cosines.</p>
<div class="figure" id="id1">
<img alt="_images/Dreieck.svg" src="_images/Dreieck.svg" /><p class="caption"><span class="caption-text">The SCP triangle.</span></p>
</div>
<p><span class="math notranslate nohighlight">\(l\)</span> is the distance the light travels from the diffraction center to the sensor.</p>
<div class="math notranslate nohighlight">
\[l^2=d^2+r^2 - 2 d r \cos(\pi/2+\alpha)\]</div>
<p><span class="math notranslate nohighlight">\(r\)</span> is the radial coordinate of the pixel P.</p>
<div class="math notranslate nohighlight">
\[r^2=l^2+d^2 -2 l d \cos(\theta)\]</div>
<p>from these two formulas the diffraction angle (here) <span class="math notranslate nohighlight">\(\theta\)</span> can be computed.</p>
<div class="math notranslate nohighlight">
\[\theta=\arccos(-r^2 -l^2 -d^2 2 l d)\]</div>
<div class="figure" id="id2">
<span id="alpha"></span><img alt="_images/winkel.svg" src="_images/winkel.svg" /><p class="caption"><span class="caption-text">Angle between two planes.</span></p>
</div>
<p><span class="math notranslate nohighlight">\(\alpha\)</span> comes from the following relation in figure <a class="reference internal" href="#alpha"><span class="std std-ref">Angle between two planes.</span></a></p>
<p>The angle between the sensor plane and the normal plane to the ray is given by <span class="math notranslate nohighlight">\(\tau\)</span>.
The slope <span class="math notranslate nohighlight">\(s\)</span> derived from  <span class="math notranslate nohighlight">\(\tau\)</span> is</p>
<div class="math notranslate nohighlight">
\[s=\sin(\tau)\]</div>
<p>On the (red) unit circle in the plane of the sensor the distance to the plane normal to the ray is expressed as</p>
<div class="math notranslate nohighlight">
\[h=\sin(\phi)s\]</div>
<p>The angle <span class="math notranslate nohighlight">\(\alpha\)</span> is therefore:</p>
<div class="math notranslate nohighlight">
\[\alpha=\arcsin(\sin(\tau)\sin(\phi))\]</div>
<p>in Python code this is <a class="reference internal" href="SAXSapi.html#SAXS.calc_theta" title="SAXS.calc_theta"><code class="xref py py-func docutils literal notranslate"><span class="pre">SAXS.calc_theta()</span></code></a>:</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calc_theta</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">theta</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">tilt</span><span class="p">,</span><span class="n">tiltdir</span><span class="p">):</span>
   <span class="n">alpha</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">tilt</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="o">+</span><span class="n">tiltdir</span><span class="p">))</span>
   <span class="n">lsquared</span><span class="o">=</span><span class="n">d</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">d</span><span class="o">*</span><span class="n">r</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="n">alpha</span><span class="p">)</span>
   <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">lsquared</span><span class="o">-</span><span class="n">d</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">lsquared</span><span class="p">)</span><span class="o">*</span><span class="n">d</span><span class="p">))</span>
</pre></div>
</div>
<p>This angle <span class="math notranslate nohighlight">\(\theta\)</span> then is calculated for every sub pixel in the sensor.
This number then can be rescaled and rounded to the nearest integer in order to get
unique integer labels for all the pixels. This labels are the index of the radial interval.</p>
<div class="section" id="tilt-angle-correction-test">
<h2>Tilt Angle Correction Test<a class="headerlink" href="#tilt-angle-correction-test" title="Permalink to this headline">¶</a></h2>
<p>To check if the tilt angle correction is working, lets create some fake calibration data, with the following peaks
in the diffraction curve:</p>
<p>(<a class="reference external" href=".//Geometry-1.py">Source code</a>, <a class="reference external" href=".//Geometry-1.png">png</a>, <a class="reference external" href=".//Geometry-1.hires.png">hires.png</a>, <a class="reference external" href=".//Geometry-1.pdf">pdf</a>)</p>
<div class="figure">
<img alt="_images/Geometry-1.png" src="_images/Geometry-1.png" />
</div>
<p>(<a class="reference external" href=".//Geometry-2.py">Source code</a>, <a class="reference external" href=".//Geometry-2.png">png</a>, <a class="reference external" href=".//Geometry-2.hires.png">hires.png</a>, <a class="reference external" href=".//Geometry-2.pdf">pdf</a>)</p>
<div class="figure">
<img alt="_images/Geometry-2.png" src="_images/Geometry-2.png" />
</div>
<p>This was done with this configuration file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;Title&quot;</span><span class="p">:</span> <span class="s2">&quot;Example Calibration&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Geometry&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;Tilt&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;TiltAngleDeg&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span>
            <span class="s2">&quot;TiltRotDeg&quot;</span><span class="p">:</span> <span class="mf">73.569</span>
        <span class="p">},</span>
        <span class="s2">&quot;DedectorDistanceMM&quot;</span><span class="p">:</span> <span class="mf">1031.657</span><span class="p">,</span>
        <span class="s2">&quot;BeamCenter&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="mf">808.37</span><span class="p">,</span>
            <span class="mf">387.772</span>
        <span class="p">],</span>
        <span class="s2">&quot;Imagesize&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="mi">1043</span><span class="p">,</span>
            <span class="mi">981</span>
        <span class="p">],</span>
        <span class="s2">&quot;PixelSizeMicroM&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="mf">172.0</span><span class="p">,</span>
            <span class="mf">172.0</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="s2">&quot;Directory&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;.&quot;</span>
    <span class="p">],</span>
    <span class="s2">&quot;Masks&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;PixelPerRadialElement&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;MaskFile&quot;</span><span class="p">:</span> <span class="s2">&quot;emptymask.tif&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Oversampling&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Phi-mode&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
            <span class="s2">&quot;qStart&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> 
            <span class="s2">&quot;qStop&quot;</span><span class="p">:</span> <span class="mf">5.0</span>
        <span class="p">}],</span>
    <span class="s2">&quot;Slices&quot;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s2">&quot;GISAXSmode&quot;</span><span class="p">:</span> <span class="n">false</span><span class="p">,</span>
    <span class="s2">&quot;Wavelength&quot;</span><span class="p">:</span> <span class="mf">1.54</span><span class="p">,</span>
    <span class="s2">&quot;Live-Filelisting&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;OverwriteFiles&quot;</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
    <span class="s2">&quot;Threads&quot;</span><span class="p">:</span> <span class="mi">2</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Which amounts to a large tilt, lets see what Fit2d makes of it</p>
<div class="code highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INFO</span><span class="p">:</span> <span class="n">SOLUTION</span> <span class="mi">2</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Best</span> <span class="n">fit</span> <span class="n">beam</span> <span class="n">centre</span> <span class="p">(</span><span class="n">X</span><span class="o">/</span><span class="n">Y</span> <span class="n">mm</span><span class="p">)</span> <span class="o">=</span>   <span class="mf">66.78356</span>      <span class="mf">138.9544</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Best</span> <span class="n">fit</span> <span class="n">beam</span> <span class="n">centre</span> <span class="p">(</span><span class="n">X</span><span class="o">/</span><span class="n">Y</span> <span class="n">pixels</span><span class="p">)</span> <span class="o">=</span>   <span class="mf">388.2765</span>      <span class="mf">807.8745</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Cone</span>  <span class="mi">1</span> <span class="n">best</span> <span class="n">fit</span> <span class="mi">2</span> <span class="n">theta</span> <span class="n">angle</span> <span class="p">(</span><span class="n">degrees</span><span class="p">)</span> <span class="o">=</span>   <span class="mf">1.392646</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Cone</span>  <span class="mi">2</span> <span class="n">best</span> <span class="n">fit</span> <span class="mi">2</span> <span class="n">theta</span> <span class="n">angle</span> <span class="p">(</span><span class="n">degrees</span><span class="p">)</span> <span class="o">=</span>   <span class="mf">2.780810</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Cone</span>  <span class="mi">3</span> <span class="n">best</span> <span class="n">fit</span> <span class="mi">2</span> <span class="n">theta</span> <span class="n">angle</span> <span class="p">(</span><span class="n">degrees</span><span class="p">)</span> <span class="o">=</span>   <span class="mf">4.168858</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Cone</span>  <span class="mi">4</span> <span class="n">best</span> <span class="n">fit</span> <span class="mi">2</span> <span class="n">theta</span> <span class="n">angle</span> <span class="p">(</span><span class="n">degrees</span><span class="p">)</span> <span class="o">=</span>   <span class="mf">5.556975</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Cone</span>  <span class="mi">5</span> <span class="n">best</span> <span class="n">fit</span> <span class="mi">2</span> <span class="n">theta</span> <span class="n">angle</span> <span class="p">(</span><span class="n">degrees</span><span class="p">)</span> <span class="o">=</span>   <span class="mf">6.944765</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Best</span> <span class="n">fit</span> <span class="n">angle</span> <span class="n">of</span> <span class="n">tilt</span> <span class="n">plane</span> <span class="n">rotation</span> <span class="p">(</span><span class="n">degrees</span><span class="p">)</span> <span class="o">=</span>   <span class="mf">73.59509</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Best</span> <span class="n">fit</span> <span class="n">angle</span> <span class="n">of</span> <span class="n">tilt</span> <span class="p">(</span><span class="n">degrees</span><span class="p">)</span> <span class="o">=</span>  <span class="o">-</span><span class="mf">10.00601</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Estimated</span> <span class="n">coordinate</span> <span class="n">radial</span> <span class="n">position</span> <span class="n">error</span> <span class="p">(</span><span class="n">mm</span><span class="p">)</span> <span class="o">=</span>  <span class="mf">0.7136476E-02</span>
<span class="n">INFO</span><span class="p">:</span> <span class="n">Estimated</span> <span class="n">coordinate</span> <span class="n">radial</span> <span class="n">position</span> <span class="n">error</span> <span class="p">(</span><span class="n">X</span> <span class="n">pixels</span><span class="p">)</span> <span class="o">=</span>  <span class="mf">0.4149114E-01</span>
</pre></div>
</div>
<p>Seems OK.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="PolCorr.html" class="btn btn-neutral float-right" title="Polarization Correction" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="MatrixMulti.html" class="btn btn-neutral float-left" title="Integration as Matrix-Vector Multiplication" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright  2019, Tu Graz, Christian Meisenbichler, Max Burian, Heinz Amenitsch

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>